<!DOCTYPE HTML>
<html>
<head>
	 <html lang="en">
	 <meta charset="utf-8" />
	 <link rel="bookmark"  type="image/x-icon"  href="/img/logo_miccall.png"/>
	 <link rel="shortcut icon" href="/img/logo_miccall.png">
	
			
<title>
    Mr.Metro
</title>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<link rel="stylesheet" href="/css/mic_main.css" />
<link rel="stylesheet" href="/css/dropdownMenu.css" />
    
    	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
<noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
</noscript>

			    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
<link rel="stylesheet" href="/css/prism-coy.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">MICCALL</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/Algorithm/">Algorithm</a></li><li><a class="category-link" href="/categories/Design/">Design</a></li><li><a class="category-link" href="/categories/Unity-3D/">Unity 3D</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="简历">
		                简历
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="团队">
		                团队
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
		            
		                <li><a href="https://github.com/miccall" class="icon fa-github"><span class="label">GitHub</span></a></li>
		            
		            
		            
		            
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url(img/ll.jpg);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >Android学习笔记 013</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <hr>
<h1 id="Android学习笔记"><a href="#Android学习笔记" class="headerlink" title=" Android学习笔记 "></a><strong> Android学习笔记 </strong></h1><h2 id="病毒"><a href="#病毒" class="headerlink" title="病毒"></a>病毒</h2><pre><code>病毒 : 一段带有恶意行为的计算机程序
恶搞 : 炫耀技术,熊猫烧香,损人不利己
灰鸽子 : 盗号,qq,游戏账号
肉机 : 通过一段程序控制的电脑

杀毒软件历史
    1.黑名单  : 将已有的病毒保存到数据库中,卡巴斯基,江民,瑞星,金山,问题:不能及时发现病毒,蜜罐,云查杀
    2.白名单  : 360  把查杀过的应用发送数据库中

手机端:黑名单
</code></pre><h2 id="手机杀毒界面"><a href="#手机杀毒界面" class="headerlink" title="手机杀毒界面"></a>手机杀毒界面</h2><pre><code>layer-list : 图层,帧布局framlayout,可以将图片一层叠一层展示,布局文件中最下面的控件,显示的时候在最上面

1.布局
</code></pre><pre><code>            &lt;RelativeLayout 
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            &gt;
            &lt;ImageView 
                android:id=&quot;@+id/iv_antivirus_anitimageview&quot;
                android:layout_width=&quot;80dp&quot;
                android:layout_height=&quot;80dp&quot;
                android:src=&quot;@drawable/ic_scanner_malware&quot;
                android:layout_margin=&quot;10dp&quot;
                /&gt;
            &lt;ImageView 
                android:id=&quot;@+id/iv_antivirus_scanner&quot;
                android:layout_width=&quot;80dp&quot;
                android:layout_height=&quot;80dp&quot;
                android:src=&quot;@drawable/act_scanning_03&quot;
                android:layout_margin=&quot;10dp&quot;
                /&gt;
            &lt;TextView 
                android:id=&quot;@+id/tv_antivirus_text&quot;
                android:layout_width=&quot;match_parent&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:text=&quot;正在扫描...&quot;
                android:layout_toRightOf=&quot;@id/iv_antivirus_anitimageview&quot;
                android:layout_marginTop=&quot;25dp&quot;
                android:textSize=&quot;18sp&quot;
                android:layout_marginRight=&quot;15dp&quot;
                /&gt;
            &lt;!-- progress : 设置进度条当前进度 --&gt;
            &lt;ProgressBar
                android:id=&quot;@+id/pb_antivirus_progressbar&quot;
                style=&quot;?android:attr/progressBarStyleHorizontal&quot;
                android:layout_width=&quot;match_parent&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:layout_below=&quot;@id/tv_antivirus_text&quot;
                android:layout_toRightOf=&quot;@id/iv_antivirus_anitimageview&quot;
                android:layout_marginTop=&quot;5dp&quot;
                android:layout_marginRight=&quot;15dp&quot;
                android:progressDrawable=&quot;@drawable/progerssbar_antivirus_bg&quot;
                android:progress=&quot;30&quot;
                /&gt;

        &lt;/RelativeLayout&gt;
</code></pre><pre><code>2.图层  res-&gt;drawable -&gt; xxx.xml
</code></pre><pre><code>       &lt;layer-list xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
            &lt;item android:id=&quot;@android:id/background&quot;&gt;
              &lt;bitmap android:src=&quot;@drawable/security_progress_bg&quot;
                android:gravity=&quot;center&quot; /&gt;
            &lt;/item&gt;
            &lt;item android:id=&quot;@android:id/secondaryProgress&quot;&gt;
              &lt;bitmap android:src=&quot;@drawable/security_progress&quot;
                android:gravity=&quot;center&quot; /&gt;
            &lt;/item&gt;
            &lt;item android:id=&quot;@android:id/progress&quot;&gt;
              &lt;bitmap android:src=&quot;@drawable/security_progress&quot;
                android:gravity=&quot;center&quot; /&gt;
            &lt;/item&gt;
        &lt;/layer-list&gt;
</code></pre><pre><code>3.更改样式,progressbar的属性
</code></pre><pre><code>        android:progressDrawable=&quot;@drawable/progerssbar_antivirus_bg&quot;
</code></pre><h2 id="扫描操作-重点-动画"><a href="#扫描操作-重点-动画" class="headerlink" title="扫描操作#  (重点:动画)"></a>扫描操作#  (重点:动画)</h2><pre><code>        //设置旋转动画
        //fromDegrees : 旋转开始的角度
        //toDegrees : 结束的角度
        //后面四个:是以自身变化还是以父控件变化
        //Animation.RELATIVE_TO_SELF : 以自身旋转
        //Animation.RELATIVE_TO_PARENT : 以父控件旋转
        RotateAnimation rotateAnimation = new RotateAnimation(0, 360, Animation.RELATIVE_TO_SELF, 0.5f, Animation.RELATIVE_TO_SELF, 0.5f);
        rotateAnimation.setDuration(1000);//持续时间
        rotateAnimation.setRepeatCount(Animation.INFINITE);//设置旋转的次数,INFINITE:一直旋转

        //设置动画插补器
        LinearInterpolator linearInterpolator = new LinearInterpolator();
        rotateAnimation.setInterpolator(linearInterpolator);
        iv_antivirus_scanner.startAnimation(rotateAnimation);
</code></pre><pre><code>展示软件列表  1.listview   2.linearlayout添加textview
</code></pre><pre class="line-numbers language-java"><code class="language-java">     <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">scanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
     * 扫描程序
     */</span>
        <span class="token comment" spellcheck="true">//1.获取包的管理者</span>
        <span class="token keyword">final</span> PackageManager pm <span class="token operator">=</span> <span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tv_antivirus_text<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"正在初始化64核杀毒引擎...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">//延迟一秒中扫描程序</span>
                SystemClock<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">//2.获取所有安装应用程序信息</span>
                List<span class="token operator">&lt;</span>PackageInfo<span class="token operator">></span> installedPackages <span class="token operator">=</span> pm<span class="token punctuation">.</span><span class="token function">getInstalledPackages</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment" spellcheck="true">//3.1设置进度条最大进度</span>
                pb_antivirus_progressbar<span class="token punctuation">.</span><span class="token function">setMax</span><span class="token punctuation">(</span>installedPackages<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">//3.2设置当前进度</span>
                <span class="token keyword">int</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span>PackageInfo packageInfo <span class="token operator">:</span> installedPackages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    SystemClock<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment" spellcheck="true">//3.设置进度条的最大进度和当前进度</span>
                    count<span class="token operator">++</span><span class="token punctuation">;</span>
                    pb_antivirus_progressbar<span class="token punctuation">.</span><span class="token function">setProgress</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment" spellcheck="true">//4.设置扫描显示软件名称</span>
                    <span class="token keyword">final</span> String name <span class="token operator">=</span> packageInfo<span class="token punctuation">.</span>applicationInfo<span class="token punctuation">.</span><span class="token function">loadLabel</span><span class="token punctuation">(</span>pm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment" spellcheck="true">//在ui线程(主线程)进行操作</span>
                    <span class="token function">runOnUiThread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//封装了handler</span>

                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            tv_antivirus_text<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"正在扫描:"</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment" spellcheck="true">//6.展示扫描软件的名称信息</span>
                            TextView textView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextView</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            textView<span class="token punctuation">.</span><span class="token function">setTextColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            textView<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment" spellcheck="true">//textview添加到线性布局中</span>
                            <span class="token comment" spellcheck="true">//ll_antivirus_safeapks.addView(textView);</span>
                            ll_antivirus_safeapks<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>textView<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//index:将textview添加到线性布局的哪个位置</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">//5.扫描完成,显示扫描完成信息,同时旋转动画停止</span>
                <span class="token function">runOnUiThread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment" spellcheck="true">//设置显示信息以及停止动画</span>
                        tv_antivirus_text<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"扫描完成,未发现病毒"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        iv_antivirus_scanner<span class="token punctuation">.</span><span class="token function">clearAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment" spellcheck="true">//移出动画</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取签名信息-重点-指定信息的标签"><a href="#获取签名信息-重点-指定信息的标签" class="headerlink" title="获取签名信息# (重点:指定信息的标签)"></a>获取签名信息# (重点:指定信息的标签)</h2><pre><code>1.指定获取签名信息标签
</code></pre><pre><code>        List&lt;PackageInfo&gt; installedPackages = pm.getInstalledPackages(PackageManager.GET_SIGNATURES);
</code></pre><pre><code>2.获取签名信息
</code></pre><pre><code>        //7.获取应用程序的签名,并进行md5加密
        Signature[] signatures= packageInfo.signatures;//获取应用程序的签名信息,获取签名的数组
        String charsString = signatures[0].toCharsString();
        //对签名信息进行MD5加密
        String signature = MD5Util.passwordMD5(charsString);
        System.out.println(name+&quot;  : &quot;+signature);
</code></pre><h2 id="手机杀毒"><a href="#手机杀毒" class="headerlink" title="手机杀毒"></a>手机杀毒</h2><pre><code>1.将病毒库导入到手机中,参考splashactivity中拷贝数据库操作,增加方法传递参数
2.创建查询数据库操作
</code></pre><pre><code>            //查询Md5值是否在数据库中
            public class AntiVirusDao {
                /**
                 * 查询Md5值是否在病毒数据库中
                 * @param context
                 * @param md5
                 * @return
                 */
                public static boolean queryAntiVirus(Context context,String md5){
                    boolean ishave = false;
                    //1.获取数据库的路径
                    File file = new File(context.getFilesDir(), &quot;antivirus.db&quot;);
                    SQLiteDatabase database = SQLiteDatabase.openDatabase(file.getAbsolutePath(), null, SQLiteDatabase.OPEN_READONLY);
                    Cursor cursor = database.query(&quot;datable&quot;, null, &quot;md5=?&quot;, new String[]{md5}, null, null, null);
                    if (cursor.moveToNext()) {
                        ishave = true;
                    }
                    cursor.close();
                    database.close();
                    return ishave;
                }
            }
</code></pre><pre><code>3.使用
</code></pre><pre><code>
        //8.查询MD5值是否在病毒数据库中
        boolean b = AntiVirusDao.queryAntiVirus(getApplicationContext(), signature);
</code></pre><pre><code>4.根据查询值,设置病毒标示
</code></pre><pre><code>       /*6.展示扫描软件的名称信息*/
        TextView textView = new TextView(getApplicationContext());
       /*9.根据返回的值将病毒标示出来*/
        if (b) {
            /*有病毒*/
            textView.setTextColor(Color.RED);
            /*将病毒的包名添加到list集合*/
            list.add(packageInfo.packageName);
        }else{
            /*没有病毒*/
            textView.setTextColor(Color.BLACK);
        }
        textView.setText(name);
</code></pre><pre><code>5.对查询到病毒进行处理
</code></pre><pre><code>                        //10.根据是否有病毒进行显示操作
                        if (list.size() &gt; 0) {
                            //有病毒
                            tv_antivirus_text.setText(&quot;扫描完成,发现&quot;+list.size()+&quot;个病毒&quot;);
                            //卸载病毒应用
                            AlertDialog.Builder builder = new Builder(AntivirusActivity.this);
                            builder.setTitle(&quot;提醒!发现&quot;+list.size()+&quot;个病毒&quot;);
                            builder.setIcon(R.drawable.ic_launcher);
                            builder.setMessage(&quot;是否卸载病毒应用!&quot;);
                            builder.setPositiveButton(&quot;卸载&quot;, new DialogInterface.OnClickListener() {

                                @Override
                                public void onClick(DialogInterface dialog, int which) {
                                    //卸载操作
                                    for (String packagname : list) {
                                        Intent intent = new Intent();
                                        intent.setAction(&quot;android.intent.action.DELETE&quot;);
                                        intent.addCategory(&quot;android.intent.category.DEFAULT&quot;);
                                        intent.setData(Uri.parse(&quot;package:&quot;+packagname));
                                        startActivity(intent);
                                    }
                                    dialog.dismiss();
                                }
                            });
                            builder.setNegativeButton(&quot;取消&quot;, null);
                            builder.show();
                        }else{
                            //设置显示信息以及停止动画
                            tv_antivirus_text.setText(&quot;扫描完成,未发现病毒&quot;);
                        }
</code></pre><h2 id="缓存清理框架-重点"><a href="#缓存清理框架-重点" class="headerlink" title="缓存清理框架# (重点!!!!!!)"></a>缓存清理框架# (重点!!!!!!)</h2><pre><code>1.将activity改为继承fragmentActivity
</code></pre><pre><code>        //如果要对fragment进行管理操作,activity必须继承fragmentActivity
        public class ClearCacheActivity extends FragmentActivity {
        }
</code></pre><pre><code>2.设置布局文件
</code></pre><pre><code>        &lt;!-- fragment替换的控件 --&gt;
        &lt;FrameLayout 
            android:id=&quot;@+id/fram_clearcache_fragment&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;match_parent&quot;
            android:layout_weight=&quot;1&quot;
            &gt;&lt;/FrameLayout&gt;
       &lt;LinearLayout 
           android:layout_width=&quot;match_parent&quot;
           android:layout_height=&quot;wrap_content&quot;
           &gt;

        &lt;Button 
            android:layout_width=&quot;0dp&quot;
            android:layout_weight=&quot;1&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;缓存清理&quot;
            android:background=&quot;@drawable/selector_contact_button&quot;
            android:onClick=&quot;cache&quot;
            /&gt;

        &lt;Button 
            android:layout_width=&quot;0dp&quot;
            android:layout_weight=&quot;1&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;SD卡清理&quot;
             android:background=&quot;@drawable/selector_contact_button&quot;
             android:onClick=&quot;sd&quot;
            /&gt;
        &lt;/LinearLayout&gt;
</code></pre><pre><code>3.创建fragment
</code></pre><pre><code>
        public class CacheFragment extends Fragment {
            /*初始化操作*/
            @Override
            public void onCreate(Bundle savedInstanceState) {
                // TODO Auto-generated method stub
                super.onCreate(savedInstanceState);
            }
            /*设置fragment的布局*/
            @Override
            public View onCreateView(LayoutInflater inflater, ViewGroup container,
                    Bundle savedInstanceState) {
                /*参数1:布局文件*/
                /*参数2:容器*/
                /*参数3:自动挂载  ,一律false*/
                View view= inflater.inflate(R.layout.fragment_cache, container, false);
                return view;
            }
            /*设置填充显示数据*/
            @Override
            public void onActivityCreated(Bundle savedInstanceState) {
                // TODO Auto-generated method stub
                super.onActivityCreated(savedInstanceState);
            }

        }
</code></pre><pre><code>4.创建fragment布局文件,线性布局,背景是红色
5.在actiivty中添加fragment
</code></pre><pre><code>@Override
protected void onCreate(Bundle savedInstanceState) {
            super.onCreate(savedInstanceState);
            setContentView(R.layout.activity_clearcache);
            /*挂载fragment*/
            /*1.获取fragment*/
            cacheFragment = new CacheFragment();
            sdFragment = new SDFragment();
            /*2.加载fragment*/
            /*2.1获取fragment的管理者*/
            supportFragmentManager = getSupportFragmentManager();
            /*2.2开启事务*/
            FragmentTransaction beginTransaction = supportFragmentManager.beginTransaction();
            /*2.3添加fragment操作*/
            /*数据不会重新刷新*/
            /*参数1:fragment要替换的控件的id*/
            /*参数2:要替换fragment*/
            beginTransaction.add(R.id.fram_clearcache_fragment, cacheFragment);
            /*界面展示以最后一个添加的为准*/
            beginTransaction.add(R.id.fram_clearcache_fragment, sdFragment);
            /*隐藏fragment操作*/
            beginTransaction.hide(sdFragment);
            /*也可以实现替换操作,数据会重新刷新*/
            /*beginTransaction.replace(arg0, arg1)*/
            /*2.4提交事务*/
            beginTransaction.commit();
        }
</code></pre><pre><code>6.隐藏显示fragment操作
</code></pre><pre><code>
public void cache(View v){

            /*隐藏sdfragment,显示cacheFragment*/

            /*1.获取事务*/
            FragmentTransaction beginTransaction = supportFragmentManager.beginTransaction();
            /*2.隐藏显示操作*/
            beginTransaction.hide(sdFragment);//隐藏fragmnt
            beginTransaction.show(cacheFragment);//显示fragment操作
            //3.提交
            beginTransaction.commit();
        }
</code></pre><h2 id="缓存清理扫描操作"><a href="#缓存清理扫描操作" class="headerlink" title="缓存清理扫描操作"></a>缓存清理扫描操作</h2><pre><code>    /**
     * 扫描
     */
    private void scanner() {
        //1.获取包的管理者
        //getActivity() : 获取fragment所在的activity
        final PackageManager pm = getActivity().getPackageManager();
        tv_cachefragment_text.setText(&quot;正在初始化128核扫描引擎.....&quot;);
        new Thread(){
            public void run() {
                SystemClock.sleep(100);
                List&lt;PackageInfo&gt; installedPackages = pm.getInstalledPackages(0);
                //设置进度条最大进度
                pb_cachefragment_progressbar.setMax(installedPackages.size());
                int count=0;
                for (PackageInfo packageInfo : installedPackages) {
                    SystemClock.sleep(100);
                    //设置进度条最大进度和当前进度
                    count++;
                    pb_cachefragment_progressbar.setProgress(count);

                    //设置扫描显示的应用的名称
                    final String name = packageInfo.applicationInfo.loadLabel(pm).toString();
                    if (getActivity() != null) {
                        getActivity().runOnUiThread(new Runnable() {

                            @Override
                            public void run() {
                                tv_cachefragment_text.setText(&quot;正在扫描:&quot;+name);
                            }
                        }); 
                    }
                }
                if (getActivity() != null) {
                    getActivity().runOnUiThread(new Runnable() {

                        @Override
                        public void run() {
                            tv_cachefragment_text.setVisibility(View.GONE);
                            pb_cachefragment_progressbar.setVisibility(View.GONE);
                        }
                    });
                }
            };
        }.start();
    }
</code></pre><h2 id="获取缓存-重点-反射-源码查看"><a href="#获取缓存-重点-反射-源码查看" class="headerlink" title="获取缓存#  (重点:反射+源码查看)"></a>获取缓存#  (重点:反射+源码查看)</h2><pre><code>1.反射操作
</code></pre><pre><code>                    //反射获取缓存
                    try {
                        Class&lt;?&gt; loadClass = getActivity().getClass().getClassLoader().loadClass(&quot;android.content.pm.PackageManager&quot;);
                        Method method = loadClass.getDeclaredMethod(&quot;getPackageSizeInfo&quot;, String.class,IPackageStatsObserver.class);
                        //receiver : 类的实例,隐藏参数,方法不是静态的必须指定
                        method.invoke(pm, packageInfo.packageName,mStatsObserver);
                    } catch (Exception e) {
                        // TODO Auto-generated catch block
                        e.printStackTrace();
                    }
</code></pre><pre><code>2.远程服务aidl
</code></pre><pre><code>        //获取缓存大小
        IPackageStatsObserver.Stub mStatsObserver = new IPackageStatsObserver.Stub() {
            public void onGetStatsCompleted(PackageStats stats, boolean succeeded) {
                long cachesize = stats.cacheSize;//缓存大小
                long codesize = stats.codeSize;//应用程序的大小
                long datasize = stats.dataSize;//数据大小

                String cache = Formatter.formatFileSize(getActivity(), cachesize);
                String code = Formatter.formatFileSize(getActivity(), codesize);
                String data = Formatter.formatFileSize(getActivity(), datasize);

                System.out.println(stats.packageName+&quot;cachesize:&quot;+cache +&quot; codesize:&quot;+code+&quot; datasize:&quot;+data);
            }
        };
</code></pre><pre><code>3.权限
</code></pre><pre><code>
        &lt;uses-permission android:name=&quot;android.permission.GET_PACKAGE_SIZE&quot; /&gt;
</code></pre><h2 id="展示缓存应用"><a href="#展示缓存应用" class="headerlink" title="展示缓存应用"></a>展示缓存应用</h2><pre><code>1.使用listview进行展示
</code></pre><pre><code>
        @Override
        public View getView(int position, View convertView, ViewGroup parent) {

            View cachView;
            ViewHolder viewHolder;
            if (convertView == null) {
                 cachView = View.inflate(getActivity(), R.layout.item_cache, null);
                 viewHolder = new ViewHolder();
                 viewHolder.iv_itemcache_icon = (ImageView) cachView.findViewById(R.id.iv_itemcache_icon);
                 viewHolder.tv_itemcache_name = (TextView) cachView.findViewById(R.id.tv_itemcache_name);
                 viewHolder.tv_itemcache_size = (TextView) cachView.findViewById(R.id.tv_itemcache_size);
                 cachView.setTag(viewHolder);
            }else{
                cachView = convertView;
                viewHolder = (ViewHolder) cachView.getTag();
            }
            //设置显示数据
            CachInfo cachInfo = list.get(position);
            //根据包名获取application信息
            try {
                ApplicationInfo applicationInfo = pm.getApplicationInfo(cachInfo.getPackageName(), 0);
                Drawable icon = applicationInfo.loadIcon(pm);
                String name = applicationInfo.loadLabel(pm).toString();
                //设置显示
                 viewHolder.iv_itemcache_icon.setImageDrawable(icon);
                 viewHolder.tv_itemcache_name.setText(name);
                 viewHolder.tv_itemcache_size.setText(cachInfo.getCachesize());
            } catch (NameNotFoundException e) {
                e.printStackTrace();
            }
            return cachView;
        }
</code></pre><h2 id="清理缓存"><a href="#清理缓存" class="headerlink" title="清理缓存"></a>清理缓存</h2><pre><code>android中当前程序是不能清理其他程序缓存

1.进入详情界面进行清理
</code></pre><pre><code>        lv_cachefragment_caches.setOnItemClickListener(new OnItemClickListener() {

            @Override
            public void onItemClick(AdapterView&lt;?&gt; parent, View view,
                    int position, long id) {
                //跳转到详情页面
                Intent intent = new Intent();
                intent.setAction(&quot;android.settings.APPLICATION_DETAILS_SETTINGS&quot;);
                intent.setData(Uri.parse(&quot;package:&quot;+list.get(position).getPackageName()));
                startActivity(intent);
            }
        });
</code></pre><pre><code>2.通过反射清理所有应用程序的缓存
</code></pre><pre><code>        //清理缓存
        btn_cachefragment_clear.setOnClickListener(new OnClickListener() {

            @Override
            public void onClick(View v) {

                    //真正的实现清理缓存
                    try {
                        Class&lt;?&gt; loadClass = getActivity().getClass().getClassLoader().loadClass(&quot;android.content.pm.PackageManager&quot;);
                        //Long.class  Long     TYPE  long
                        Method method = loadClass.getDeclaredMethod(&quot;freeStorageAndNotify&quot;, Long.TYPE,IPackageDataObserver.class);
                        method.invoke(pm, Long.MAX_VALUE,new MyIPackageDataObserver());
                    } catch (Exception e) {
                        // TODO Auto-generated catch block
                        e.printStackTrace();
                    }

                    //清理缓存
                    list.clear();
                    //更新界面
                    myadapter.notifyDataSetChanged();
                    //隐藏button按钮
                    btn_cachefragment_clear.setVisibility(View.GONE);
                }
        });
</code></pre><h2 id="异常捕获-重点"><a href="#异常捕获-重点" class="headerlink" title="异常捕获#  (重点)"></a>异常捕获#  (重点)</h2><pre><code>
public class MyApplication extends Application {
    //异常捕获
    //Application : 当前的应用程序,所有的应用最先的执行都是applicaiton
        @Override
        public void onCreate() {
            super.onCreate();
            System.out.println(&quot;applcation启动了......&quot;);
            Thread.currentThread().setUncaughtExceptionHandler(new MyUncaughtExceptionHandler());
        }
        private class MyUncaughtExceptionHandler implements UncaughtExceptionHandler{
            //系统中由未捕获的异常的时候调用
            //Throwable : Error和Exception的父类
            @Override
            public void uncaughtException(Thread thread, Throwable ex) {
                System.out.println(&quot;哥捕获异常了......&quot;);
                ex.printStackTrace();
                try {
                    //将捕获到异常,保存到SD卡中
                    ex.printStackTrace(new PrintStream(new File(&quot;/mnt/sdcard/log.txt&quot;)));
                } catch (FileNotFoundException e)
</code></pre>
            </div>

            <!-- Post Comments -->
            
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'http-miccall-tech'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://miccall.tech/android/android_013.html';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://miccall.tech/android/android_013.html'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//http-miccall-tech.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
            	<span id="busuanzi_container_site_pv">2018总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
